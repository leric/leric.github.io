---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import NewsletterSignup from '../components/NewsletterSignup.astro';
import { Image } from 'astro:assets';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
	</head>
	<body>
		<div class="reading-progress" id="reading-progress"></div>
		<Header />
		<main>
			<article class="blog-post">
				<!-- Article Header -->
				<header class="article-header">
					<div class="article-meta-top">
						<span class="category-tag">Product</span>
						<div class="meta-info">
							<FormattedDate date={pubDate} />
							{updatedDate && (
								<span class="updated-date">
									Updated <FormattedDate date={updatedDate} />
								</span>
							)}
							<span class="reading-time">5 min read</span>
						</div>
					</div>
					<h1 class="article-title">{title}</h1>
					<p class="article-subtitle">{description}</p>
				</header>

				<!-- Hero Image -->
				{heroImage && (
					<div class="hero-image">
						<Image 
							src={heroImage} 
							alt={title}
							width={680}
							height={400}
							loading="eager"
						/>
					</div>
				)}

				<!-- Article Content -->
				<div class="article-content">
					<slot />
				</div>

				<!-- Newsletter Signup -->
				<div class="article-newsletter">
					<NewsletterSignup />
				</div>

				<!-- Article Footer -->
				<footer class="article-footer">
					<div class="article-tags">
						<span class="tag">Product Management</span>
						<span class="tag">Strategy</span>
						<span class="tag">Growth</span>
					</div>
					<div class="share-section">
						<p class="share-text">Found this useful? Share it with your network:</p>
						<div class="share-buttons">
							<button class="share-btn twitter" onclick="shareOnTwitter()">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
									<path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
								</svg>
								Twitter
							</button>
							<button class="share-btn linkedin" onclick="shareOnLinkedIn()">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
									<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
								</svg>
								LinkedIn
							</button>
							<button class="share-btn copy" onclick="copyLink()">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
									<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
									<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
								</svg>
								Copy Link
							</button>
						</div>
					</div>
				</footer>
			</article>
		</main>
		<Footer />

		<script>
			// Reading progress indicator
			function updateReadingProgress() {
				const article = document.querySelector('.article-content');
				const progressBar = document.getElementById('reading-progress');
				
				if (!article || !progressBar) return;
				
				const articleTop = article.offsetTop;
				const articleHeight = article.offsetHeight;
				const windowHeight = window.innerHeight;
				const scrollTop = window.pageYOffset;
				
				const progress = Math.min(
					Math.max((scrollTop - articleTop + windowHeight * 0.3) / articleHeight, 0),
					1
				);
				
				progressBar.style.width = `${progress * 100}%`;
			}
			
			// Share functions
			function shareOnTwitter() {
				const url = encodeURIComponent(window.location.href);
				const text = encodeURIComponent(document.title);
				window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
			}
			
			function shareOnLinkedIn() {
				const url = encodeURIComponent(window.location.href);
				window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
			}
			
			function copyLink() {
				navigator.clipboard.writeText(window.location.href).then(() => {
					const btn = document.querySelector('.share-btn.copy');
					const originalText = btn.innerHTML;
					btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"></polyline></svg>Copied!';
					setTimeout(() => {
						btn.innerHTML = originalText;
					}, 2000);
				});
			}
			
			// Event listeners
			window.addEventListener('scroll', updateReadingProgress);
			window.addEventListener('resize', updateReadingProgress);
			document.addEventListener('DOMContentLoaded', updateReadingProgress);
			
			// Make functions global
			window.shareOnTwitter = shareOnTwitter;
			window.shareOnLinkedIn = shareOnLinkedIn;
			window.copyLink = copyLink;
		</script>
	</body>
</html>

<style>
	.blog-post {
		max-width: var(--max-width);
		margin: 0 auto;
		padding: 0 var(--content-padding);
	}
	
	/* Reading Progress */
	.reading-progress {
		position: fixed;
		top: 0;
		left: 0;
		width: 0%;
		height: 3px;
		background: var(--accent);
		z-index: 1000;
		transition: width 0.1s ease;
	}
	
	/* Article Header */
	.article-header {
		padding: 40px 0;
		border-bottom: 1px solid var(--border);
		margin-bottom: 32px;
	}
	
	.article-meta-top {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 24px;
		flex-wrap: wrap;
		gap: 16px;
	}
	
	.category-tag {
		background: var(--accent);
		color: white;
		padding: 6px 12px;
		border-radius: 16px;
		font-size: 12px;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}
	
	.meta-info {
		display: flex;
		align-items: center;
		gap: 16px;
		font-size: 14px;
		color: var(--text-muted);
		flex-wrap: wrap;
	}
	
	.updated-date::before,
	.reading-time::before {
		content: 'â€¢';
		margin-right: 16px;
		color: var(--border);
	}
	
	.article-title {
		font-size: clamp(28px, 5vw, 42px);
		font-weight: 800;
		color: var(--primary);
		margin-bottom: 16px;
		letter-spacing: -0.03em;
		line-height: 1.2;
	}
	
	.article-subtitle {
		font-size: 18px;
		line-height: 1.6;
		color: var(--secondary);
		margin: 0;
		font-weight: 400;
	}
	
	/* Hero Image */
	.hero-image {
		margin: 0 0 40px 0;
		border-radius: var(--card-radius);
		overflow: hidden;
		background: var(--background-alt);
	}
	
	.hero-image img {
		width: 100%;
		height: auto;
		display: block;
		margin: 0;
	}
	
	/* Article Content */
	.article-content {
		font-size: 18px;
		line-height: 1.7;
		color: var(--primary);
		margin-bottom: 48px;
	}
	
	.article-content > *:first-child {
		margin-top: 0;
	}
	
	.article-content > *:last-child {
		margin-bottom: 0;
	}
	
	.article-content h2 {
		margin-top: 48px;
		margin-bottom: 16px;
		font-size: 24px;
	}
	
	.article-content h3 {
		margin-top: 40px;
		margin-bottom: 12px;
		font-size: 20px;
	}
	
	.article-content p {
		margin-bottom: 24px;
	}
	
	.article-content blockquote {
		margin: 32px 0;
		padding: 20px 24px;
		background: var(--background-alt);
		border-left: 4px solid var(--accent);
		border-radius: 0 var(--card-radius) var(--card-radius) 0;
		font-size: 20px;
		line-height: 1.6;
		color: var(--secondary);
		font-style: italic;
	}
	
	.article-content img {
		margin: 32px 0;
		border-radius: var(--card-radius);
		box-shadow: var(--shadow-sm);
	}
	
	.article-content pre {
		margin: 32px 0;
		font-size: 14px;
		line-height: 1.6;
	}
	
	.article-content ul,
	.article-content ol {
		margin: 24px 0;
		padding-left: 24px;
	}
	
	.article-content li {
		margin-bottom: 8px;
	}
	
	/* Newsletter Signup in Article */
	.article-newsletter {
		margin: 48px 0;
		padding: 32px 0;
		border-top: 1px solid var(--border);
		border-bottom: 1px solid var(--border);
	}
	
	/* Article Footer */
	.article-footer {
		padding: 32px 0;
	}
	
	.article-tags {
		margin-bottom: 32px;
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
	}
	
	.share-section {
		text-align: center;
	}
	
	.share-text {
		font-size: 16px;
		color: var(--secondary);
		margin-bottom: 20px;
		font-weight: 500;
	}
	
	.share-buttons {
		display: flex;
		justify-content: center;
		gap: 12px;
		flex-wrap: wrap;
	}
	
	.share-btn {
		display: flex;
		align-items: center;
		gap: 8px;
		background: white;
		border: 1px solid var(--border);
		padding: 10px 20px;
		border-radius: 6px;
		color: var(--secondary);
		font-size: 14px;
		font-weight: 500;
		cursor: pointer;
		transition: all 0.2s ease;
		text-decoration: none;
		font-family: var(--font-primary);
	}
	
	.share-btn:hover {
		background: var(--background-alt);
		color: var(--primary);
		transform: translateY(-1px);
	}
	
	.share-btn.twitter:hover {
		background: #1da1f2;
		color: white;
		border-color: #1da1f2;
	}
	
	.share-btn.linkedin:hover {
		background: #0077b5;
		color: white;
		border-color: #0077b5;
	}
	
	.share-btn.copy:hover {
		background: var(--success);
		color: white;
		border-color: var(--success);
	}
	
	/* Responsive Design */
	@media (max-width: 768px) {
		.article-header {
			padding: 32px 0;
			margin-bottom: 24px;
		}
		
		.article-meta-top {
			flex-direction: column;
			align-items: flex-start;
			gap: 12px;
		}
		
		.meta-info {
			flex-wrap: wrap;
			gap: 12px;
		}
		
		.updated-date::before,
		.reading-time::before {
			content: '';
			margin-right: 0;
		}
		
		.article-subtitle {
			font-size: 16px;
		}
		
		.article-content {
			font-size: 16px;
			margin-bottom: 40px;
		}
		
		.article-content blockquote {
			font-size: 18px;
			padding: 16px 20px;
			margin: 24px 0;
		}
		
		.article-newsletter {
			margin: 40px 0;
			padding: 24px 0;
		}
		
		.share-buttons {
			flex-direction: column;
			align-items: center;
		}
		
		.share-btn {
			width: 200px;
			justify-content: center;
		}
	}
	
	@media (max-width: 480px) {
		.article-header {
			padding: 24px 0;
			margin-bottom: 20px;
		}
		
		.article-content {
			font-size: 15px;
		}
		
		.article-content blockquote {
			font-size: 16px;
			padding: 12px 16px;
		}
	}
</style>